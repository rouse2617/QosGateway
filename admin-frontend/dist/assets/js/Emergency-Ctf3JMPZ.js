var e=(e,a,l)=>new Promise((t,r)=>{var n=e=>{try{o(l.next(e))}catch(a){r(a)}},u=e=>{try{o(l.throw(e))}catch(a){r(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,u);o((l=l.apply(e,a)).next())});import{e as a}from"./index-JEKLdrSO.js";import{d as l,r as t,f as r,o as n,I as u,J as o,B as i,A as d,x as s,a0 as c,y as p,L as v,K as m,Q as f,R as y,U as _,V as g,E as h,z as b}from"./element-plus-DA67S2ud.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";const w={class:"emergency-page"},V={class:"card-header"},k={class:"actions",style:{"margin-top":"20px"}},C=x(l({__name:"Emergency",setup(l){const x=t(null),C=t(!1),P=t(!1),I=r({reason:"",duration:300}),U=[{priority:"P0",ratio:"100%",desc:"完全保障",type:"danger"},{priority:"P1",ratio:"50%",desc:"部分保障",type:"warning"},{priority:"P2",ratio:"10%",desc:"最低保障",type:"info"},{priority:"P3+",ratio:"0%",desc:"完全限制",type:"success"}],j=t([{type:"deactivated",reason:"系统恢复正常",timestamp:"2024-01-15T10:30:00Z"},{type:"activated",reason:"流量突增",timestamp:"2024-01-15T10:00:00Z"}]);function E(){return e(this,null,function*(){try{const{data:e}=yield a.getStatus();x.value=e}catch(e){x.value={active:!1,reason:"",activated_at:"",expires_at:"",duration:0}}})}function L(){I.reason="",I.duration=300,P.value=!0}function S(){return e(this,null,function*(){var e,l;C.value=!0;try{yield a.activate(I.reason||"手动激活",I.duration),h.success("紧急模式已激活"),P.value=!1,E()}catch(t){h.error((null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.error)||"激活失败")}finally{C.value=!1}})}function T(){return e(this,null,function*(){var e,l;C.value=!0;try{yield a.deactivate(),h.success("紧急模式已停用"),E()}catch(t){h.error((null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.error)||"停用失败")}finally{C.value=!1}})}function Z(e){return e?new Date(e).toLocaleString():"-"}let z=null;return n(()=>{E(),z=window.setInterval(E,5e3)}),u(()=>{z&&clearInterval(z)}),(e,a)=>{const l=s("el-tag"),t=s("el-descriptions-item"),r=s("el-descriptions"),n=s("Warning"),u=s("el-icon"),h=s("el-button"),E=s("CircleCheck"),z=s("el-card"),A=s("el-col"),B=s("el-table-column"),D=s("el-table"),J=s("el-row"),K=s("el-timeline-item"),Q=s("el-timeline"),R=s("el-alert"),W=s("el-input"),q=s("el-form-item"),F=s("el-option"),G=s("el-select"),H=s("el-form"),M=s("el-dialog");return b(),o("div",w,[i(J,{gutter:20},{default:d(()=>[i(A,{span:12},{default:d(()=>{var e;return[i(z,{class:c({"emergency-active":null==(e=x.value)?void 0:e.active})},{header:d(()=>{var e;return[m("div",V,[a[4]||(a[4]=m("span",null,"紧急模式状态",-1)),i(l,{type:(null==(e=x.value)?void 0:e.active)?"danger":"success"},{default:d(()=>{var e;return[f(y((null==(e=x.value)?void 0:e.active)?"已激活":"正常"),1)]}),_:1},8,["type"])])]}),default:d(()=>{var e,l;return[(null==(e=x.value)?void 0:e.active)?(b(),p(r,{key:0,column:1,border:""},{default:d(()=>[i(t,{label:"激活原因"},{default:d(()=>[f(y(x.value.reason),1)]),_:1}),i(t,{label:"激活时间"},{default:d(()=>[f(y(Z(x.value.activated_at)),1)]),_:1}),i(t,{label:"过期时间"},{default:d(()=>[f(y(Z(x.value.expires_at)),1)]),_:1})]),_:1})):v("",!0),m("div",k,[(null==(l=x.value)?void 0:l.active)?(b(),p(h,{key:1,type:"success",onClick:T,loading:C.value},{default:d(()=>[i(u,null,{default:d(()=>[i(E)]),_:1}),a[6]||(a[6]=f("停用紧急模式 ",-1))]),_:1},8,["loading"])):(b(),p(h,{key:0,type:"danger",onClick:L},{default:d(()=>[i(u,null,{default:d(()=>[i(n)]),_:1}),a[5]||(a[5]=f("激活紧急模式 ",-1))]),_:1}))])]}),_:1},8,["class"])]}),_:1}),i(A,{span:12},{default:d(()=>[i(z,null,{header:d(()=>[...a[7]||(a[7]=[f("优先级配额说明",-1)])]),default:d(()=>[i(D,{data:U,stripe:""},{default:d(()=>[i(B,{prop:"priority",label:"优先级",width:"100"},{default:d(({row:e})=>[i(l,{type:e.type},{default:d(()=>[f(y(e.priority),1)]),_:2},1032,["type"])]),_:1}),i(B,{prop:"ratio",label:"紧急模式配额"}),i(B,{prop:"desc",label:"说明"})]),_:1})]),_:1})]),_:1})]),_:1}),i(z,{style:{"margin-top":"20px"}},{header:d(()=>[...a[8]||(a[8]=[f("紧急模式历史",-1)])]),default:d(()=>[i(Q,null,{default:d(()=>[(b(!0),o(_,null,g(j.value,e=>(b(),p(K,{key:e.timestamp,timestamp:Z(e.timestamp),type:"activated"===e.type?"danger":"success"},{default:d(()=>[f(y("activated"===e.type?"激活":"停用")+" - "+y(e.reason),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1}),i(M,{modelValue:P.value,"onUpdate:modelValue":a[3]||(a[3]=e=>P.value=e),title:"激活紧急模式",width:"400px"},{footer:d(()=>[i(h,{onClick:a[2]||(a[2]=e=>P.value=!1)},{default:d(()=>[...a[10]||(a[10]=[f("取消",-1)])]),_:1}),i(h,{type:"danger",onClick:S,loading:C.value},{default:d(()=>[...a[11]||(a[11]=[f("确认激活",-1)])]),_:1},8,["loading"])]),default:d(()=>[i(R,{type:"warning",closable:!1,style:{"margin-bottom":"20px"}},{default:d(()=>[...a[9]||(a[9]=[f(" 激活紧急模式后，低优先级应用的请求将被限制或拒绝。 ",-1)])]),_:1}),i(H,{model:I,"label-width":"80px"},{default:d(()=>[i(q,{label:"原因"},{default:d(()=>[i(W,{modelValue:I.reason,"onUpdate:modelValue":a[0]||(a[0]=e=>I.reason=e),placeholder:"请输入激活原因"},null,8,["modelValue"])]),_:1}),i(q,{label:"持续时间"},{default:d(()=>[i(G,{modelValue:I.duration,"onUpdate:modelValue":a[1]||(a[1]=e=>I.duration=e)},{default:d(()=>[i(F,{value:300,label:"5 分钟"}),i(F,{value:600,label:"10 分钟"}),i(F,{value:1800,label:"30 分钟"}),i(F,{value:3600,label:"1 小时"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-220ee5f2"]]);export{C as default};
