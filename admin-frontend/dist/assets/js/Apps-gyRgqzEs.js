var e=(e,a,l)=>new Promise((t,o)=>{var u=e=>{try{n(l.next(e))}catch(a){o(a)}},r=e=>{try{n(l.throw(e))}catch(a){o(a)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(u,r);n((l=l.apply(e,a)).next())});import{c as a}from"./index-JEKLdrSO.js";import{d as l,r as t,f as o,o as u,J as r,B as n,A as d,x as i,a3 as p,a4 as s,y as _,Q as m,R as c,K as f,E as v,z as b}from"./element-plus-DA67S2ud.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const g={class:"apps-page"},h={class:"card-header"},w=y(l({__name:"Apps",setup(l){const y=t([]),w=t(!1),V=t(!1),x=t(!1),q=t(!1),k=t(),P=o({app_id:"",guaranteed_quota:1e4,burst_quota:5e4,priority:2,max_borrow:1e4,max_connections:1e3}),C={app_id:[{required:!0,message:"请输入应用 ID",trigger:"blur"}],guaranteed_quota:[{required:!0,message:"请输入保证配额",trigger:"blur"}]};function U(){return e(this,null,function*(){w.value=!0;try{const{data:e}=yield a.list();y.value=e.apps||[]}finally{w.value=!1}})}function j(e){x.value=!!e,e?Object.assign(P,e):Object.assign(P,{app_id:"",guaranteed_quota:1e4,burst_quota:5e4,priority:2,max_borrow:1e4,max_connections:1e3}),V.value=!0}function D(){return e(this,null,function*(){k.value&&(yield k.value.validate(l=>e(this,null,function*(){var e,t;if(l){q.value=!0;try{x.value?yield a.update(P.app_id,P):yield a.create(P),v.success(x.value?"更新成功":"创建成功"),V.value=!1,U()}catch(o){v.error((null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.error)||"操作失败")}finally{q.value=!1}}})))})}function I(e){return(null==e?void 0:e.toLocaleString())||"0"}return u(U),(l,t)=>{const o=i("Plus"),u=i("el-icon"),A=i("el-button"),L=i("el-table-column"),O=i("el-tag"),R=i("el-popconfirm"),S=i("el-table"),z=i("el-card"),B=i("el-input"),E=i("el-form-item"),J=i("el-input-number"),K=i("el-option"),Q=i("el-select"),F=i("el-form"),G=i("el-dialog"),H=s("loading");return b(),r("div",g,[n(z,null,{header:d(()=>[f("div",h,[t[10]||(t[10]=f("span",null,"应用管理",-1)),n(A,{type:"primary",onClick:t[0]||(t[0]=e=>j())},{default:d(()=>[n(u,null,{default:d(()=>[n(o)]),_:1}),t[9]||(t[9]=m("新建应用 ",-1))]),_:1})])]),default:d(()=>[p((b(),_(S,{data:y.value,stripe:""},{default:d(()=>[n(L,{prop:"app_id",label:"应用 ID",width:"180"}),n(L,{prop:"guaranteed_quota",label:"保证配额",width:"120"},{default:d(({row:e})=>[m(c(I(e.guaranteed_quota))+"/s",1)]),_:1}),n(L,{prop:"burst_quota",label:"突发配额",width:"120"},{default:d(({row:e})=>[m(c(I(e.burst_quota)),1)]),_:1}),n(L,{prop:"priority",label:"优先级",width:"100"},{default:d(({row:e})=>{return[n(O,{type:(a=e.priority,["danger","warning","info","success"][a]||"info")},{default:d(()=>[m("P"+c(e.priority),1)]),_:2},1032,["type"])];var a}),_:1}),n(L,{prop:"max_connections",label:"最大连接",width:"100"}),n(L,{prop:"updated_at",label:"更新时间",width:"180"},{default:d(({row:e})=>{return[m(c((a=e.updated_at,a?new Date(a).toLocaleString():"-")),1)];var a}),_:1}),n(L,{label:"操作",width:"150",fixed:"right"},{default:d(({row:l})=>[n(A,{link:"",type:"primary",onClick:e=>j(l)},{default:d(()=>[...t[11]||(t[11]=[m("编辑",-1)])]),_:1},8,["onClick"]),n(R,{title:"确定删除?",onConfirm:t=>function(l){return e(this,null,function*(){var e,t;try{yield a.delete(l),v.success("删除成功"),U()}catch(o){v.error((null==(t=null==(e=o.response)?void 0:e.data)?void 0:t.error)||"删除失败")}})}(l.app_id)},{reference:d(()=>[n(A,{link:"",type:"danger"},{default:d(()=>[...t[12]||(t[12]=[m("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[H,w.value]])]),_:1}),n(G,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=e=>V.value=e),title:x.value?"编辑应用":"新建应用",width:"500px"},{footer:d(()=>[n(A,{onClick:t[7]||(t[7]=e=>V.value=!1)},{default:d(()=>[...t[14]||(t[14]=[m("取消",-1)])]),_:1}),n(A,{type:"primary",onClick:D,loading:q.value},{default:d(()=>[...t[15]||(t[15]=[m("确定",-1)])]),_:1},8,["loading"])]),default:d(()=>[n(F,{ref_key:"formRef",ref:k,model:P,rules:C,"label-width":"100px"},{default:d(()=>[n(E,{label:"应用 ID",prop:"app_id"},{default:d(()=>[n(B,{modelValue:P.app_id,"onUpdate:modelValue":t[1]||(t[1]=e=>P.app_id=e),disabled:x.value,placeholder:"唯一标识符"},null,8,["modelValue","disabled"])]),_:1}),n(E,{label:"保证配额",prop:"guaranteed_quota"},{default:d(()=>[n(J,{modelValue:P.guaranteed_quota,"onUpdate:modelValue":t[2]||(t[2]=e=>P.guaranteed_quota=e),min:1,max:1e7},null,8,["modelValue"]),t[13]||(t[13]=f("span",{class:"unit"},"/秒",-1))]),_:1}),n(E,{label:"突发配额",prop:"burst_quota"},{default:d(()=>[n(J,{modelValue:P.burst_quota,"onUpdate:modelValue":t[3]||(t[3]=e=>P.burst_quota=e),min:1,max:1e7},null,8,["modelValue"])]),_:1}),n(E,{label:"优先级",prop:"priority"},{default:d(()=>[n(Q,{modelValue:P.priority,"onUpdate:modelValue":t[4]||(t[4]=e=>P.priority=e)},{default:d(()=>[n(K,{value:0,label:"P0 - 最高"}),n(K,{value:1,label:"P1 - 高"}),n(K,{value:2,label:"P2 - 中"}),n(K,{value:3,label:"P3 - 低"})]),_:1},8,["modelValue"])]),_:1}),n(E,{label:"最大借用"},{default:d(()=>[n(J,{modelValue:P.max_borrow,"onUpdate:modelValue":t[5]||(t[5]=e=>P.max_borrow=e),min:0},null,8,["modelValue"])]),_:1}),n(E,{label:"最大连接"},{default:d(()=>[n(J,{modelValue:P.max_connections,"onUpdate:modelValue":t[6]||(t[6]=e=>P.max_connections=e),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-37e087f5"]]);export{w as default};
