var e=(e,l,a)=>new Promise((t,r)=>{var i=e=>{try{d(a.next(e))}catch(l){r(l)}},u=e=>{try{d(a.throw(e))}catch(l){r(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,u);d((a=a.apply(e,l)).next())});import{g as l}from"./index-JEKLdrSO.js";import{d as a,r as t,f as r,o as i,J as u,B as d,A as o,x as p,Q as n,E as c,z as s}from"./element-plus-DA67S2ud.js";const m={class:"connections-page"},f=a({__name:"Connections",setup(a){const f=t("app"),_=t([]),v=t([]),b=t(!1),y=t(!1),g=r({target_type:"",target_id:"",limit:1e3});function h(){return e(this,null,function*(){try{const{data:e}=yield l.getStats(),a=e.connections||[];_.value=a.filter(e=>"app"===e.type),v.value=a.filter(e=>"cluster"===e.type)}catch(e){_.value=[{type:"app",id:"app-1",current:150,limit:1e3,peak:200,rejected:5},{type:"app",id:"app-2",current:80,limit:500,peak:120,rejected:2}],v.value=[{type:"cluster",id:"cluster-1",current:500,limit:5e3,peak:800,rejected:10}]}})}function k(e,l){g.target_type=e,g.target_id=l.id,g.limit=l.limit,b.value=!0}function V(){return e(this,null,function*(){var e,a;y.value=!0;try{yield l.updateLimit(g.target_type,g.target_id,g.limit),c.success("更新成功"),b.value=!1,h()}catch(t){c.error((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||"更新失败")}finally{y.value=!1}})}return i(h),(e,l)=>{const a=p("el-table-column"),t=p("el-button"),r=p("el-table"),i=p("el-tab-pane"),c=p("el-tabs"),h=p("el-card"),w=p("el-input"),j=p("el-form-item"),x=p("el-input-number"),C=p("el-form"),U=p("el-dialog");return s(),u("div",m,[d(h,null,{header:o(()=>[...l[5]||(l[5]=[n("连接限制配置",-1)])]),default:o(()=>[d(c,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e)},{default:o(()=>[d(i,{label:"应用连接",name:"app"},{default:o(()=>[d(r,{data:_.value,stripe:""},{default:o(()=>[d(a,{prop:"id",label:"应用 ID"}),d(a,{prop:"current",label:"当前连接"}),d(a,{prop:"limit",label:"连接限制"}),d(a,{prop:"peak",label:"峰值"}),d(a,{prop:"rejected",label:"拒绝数"}),d(a,{label:"操作",width:"100"},{default:o(({row:e})=>[d(t,{link:"",type:"primary",onClick:l=>k("app",e)},{default:o(()=>[...l[6]||(l[6]=[n("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),d(i,{label:"集群连接",name:"cluster"},{default:o(()=>[d(r,{data:v.value,stripe:""},{default:o(()=>[d(a,{prop:"id",label:"集群 ID"}),d(a,{prop:"current",label:"当前连接"}),d(a,{prop:"limit",label:"连接限制"}),d(a,{prop:"peak",label:"峰值"}),d(a,{prop:"rejected",label:"拒绝数"}),d(a,{label:"操作",width:"100"},{default:o(({row:e})=>[d(t,{link:"",type:"primary",onClick:l=>k("cluster",e)},{default:o(()=>[...l[7]||(l[7]=[n("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(U,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=e=>b.value=e),title:"编辑连接限制",width:"400px"},{footer:o(()=>[d(t,{onClick:l[3]||(l[3]=e=>b.value=!1)},{default:o(()=>[...l[8]||(l[8]=[n("取消",-1)])]),_:1}),d(t,{type:"primary",onClick:V,loading:y.value},{default:o(()=>[...l[9]||(l[9]=[n("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[d(C,{model:g,"label-width":"80px"},{default:o(()=>[d(j,{label:"目标 ID"},{default:o(()=>[d(w,{modelValue:g.target_id,"onUpdate:modelValue":l[1]||(l[1]=e=>g.target_id=e),disabled:""},null,8,["modelValue"])]),_:1}),d(j,{label:"连接限制"},{default:o(()=>[d(x,{modelValue:g.limit,"onUpdate:modelValue":l[2]||(l[2]=e=>g.limit=e),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{f as default};
