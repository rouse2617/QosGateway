var e=(e,l,a)=>new Promise((t,o)=>{var r=e=>{try{u(a.next(e))}catch(l){o(l)}},d=e=>{try{u(a.throw(e))}catch(l){o(l)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,d);u((a=a.apply(e,l)).next())});import{f as l}from"./index-JEKLdrSO.js";import{d as a,r as t,f as o,c as r,o as d,J as u,B as n,A as i,x as s,a3 as m,a4 as c,y as p,Q as _,R as f,K as v,E as h,z as y}from"./element-plus-DA67S2ud.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";const b={class:"clusters-page"},V=x(a({__name:"Clusters",setup(a){const x=t([]),V=t(!1),g=t(!1),w=t(!1),U=o({cluster_id:"",max_capacity:1e6,reserved_ratio:.1,emergency_threshold:.95,max_connections:5e3}),k=r({get:()=>100*(U.reserved_ratio||0),set:e=>{U.reserved_ratio=e/100}}),C=r({get:()=>100*(U.emergency_threshold||0),set:e=>{U.emergency_threshold=e/100}});function j(){return e(this,null,function*(){V.value=!0;try{const{data:e}=yield l.list();x.value=e.clusters||[]}finally{V.value=!1}})}function I(){return e(this,null,function*(){var e,a;w.value=!0;try{yield l.update(U.cluster_id,U),h.success("更新成功"),g.value=!1,j()}catch(t){h.error((null==(a=null==(e=t.response)?void 0:e.data)?void 0:a.error)||"更新失败")}finally{w.value=!1}})}return d(j),(e,l)=>{const a=s("el-table-column"),t=s("el-button"),o=s("el-table"),r=s("el-card"),d=s("el-input"),h=s("el-form-item"),j=s("el-input-number"),D=s("el-slider"),F=s("el-form"),P=s("el-dialog"),R=c("loading");return y(),u("div",b,[n(r,null,{header:i(()=>[...l[7]||(l[7]=[_("集群配置",-1)])]),default:i(()=>[m((y(),p(o,{data:x.value,stripe:""},{default:i(()=>[n(a,{prop:"cluster_id",label:"集群 ID",width:"180"}),n(a,{prop:"max_capacity",label:"最大容量",width:"150"},{default:i(({row:e})=>{return[_(f((l=e.max_capacity,(null==l?void 0:l.toLocaleString())||"0"))+"/s",1)];var l}),_:1}),n(a,{prop:"reserved_ratio",label:"预留比例",width:"120"},{default:i(({row:e})=>[_(f((100*e.reserved_ratio).toFixed(0))+"%",1)]),_:1}),n(a,{prop:"emergency_threshold",label:"紧急阈值",width:"120"},{default:i(({row:e})=>[_(f((100*e.emergency_threshold).toFixed(0))+"%",1)]),_:1}),n(a,{prop:"max_connections",label:"最大连接",width:"120"}),n(a,{label:"操作",width:"100"},{default:i(({row:e})=>[n(t,{link:"",type:"primary",onClick:l=>{return a=e,Object.assign(U,a),void(g.value=!0);var a}},{default:i(()=>[...l[8]||(l[8]=[_("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,V.value]])]),_:1}),n(P,{modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=e=>g.value=e),title:"编辑集群",width:"500px"},{footer:i(()=>[n(t,{onClick:l[5]||(l[5]=e=>g.value=!1)},{default:i(()=>[...l[10]||(l[10]=[_("取消",-1)])]),_:1}),n(t,{type:"primary",onClick:I,loading:w.value},{default:i(()=>[...l[11]||(l[11]=[_("确定",-1)])]),_:1},8,["loading"])]),default:i(()=>[n(F,{ref:"formRef",model:U,"label-width":"100px"},{default:i(()=>[n(h,{label:"集群 ID"},{default:i(()=>[n(d,{modelValue:U.cluster_id,"onUpdate:modelValue":l[0]||(l[0]=e=>U.cluster_id=e),disabled:""},null,8,["modelValue"])]),_:1}),n(h,{label:"最大容量"},{default:i(()=>[n(j,{modelValue:U.max_capacity,"onUpdate:modelValue":l[1]||(l[1]=e=>U.max_capacity=e),min:1},null,8,["modelValue"]),l[9]||(l[9]=v("span",{class:"unit"},"/秒",-1))]),_:1}),n(h,{label:"预留比例"},{default:i(()=>[n(D,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=e=>k.value=e),min:0,max:50,"format-tooltip":e=>e+"%"},null,8,["modelValue","format-tooltip"])]),_:1}),n(h,{label:"紧急阈值"},{default:i(()=>[n(D,{modelValue:C.value,"onUpdate:modelValue":l[3]||(l[3]=e=>C.value=e),min:50,max:100,"format-tooltip":e=>e+"%"},null,8,["modelValue","format-tooltip"])]),_:1}),n(h,{label:"最大连接"},{default:i(()=>[n(j,{modelValue:U.max_connections,"onUpdate:modelValue":l[4]||(l[4]=e=>U.max_connections=e),min:1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-da8c143d"]]);export{V as default};
