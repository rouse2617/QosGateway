var e=(e,a,l)=>new Promise((r,s)=>{var o=e=>{try{t(l.next(e))}catch(a){s(a)}},n=e=>{try{t(l.throw(e))}catch(a){s(a)}},t=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);t((l=l.apply(e,a)).next())});import{r as a,o as l,I as r,d as s,f as o,c as n,J as t,B as i,K as u,A as d,x as p,z as m,L as c,M as f,N as v,u as g,O as w,P as h,Q as b,R as y,S as _}from"./element-plus-DA67S2ud.js";import{u as x,a as L}from"./index-JEKLdrSO.js";import{u as E}from"./useToast-hTRWXoI1.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";const z={class:"login-container"},j={class:"card-header"},k={key:0,class:"offline-warning"},O=V(s({__name:"Login",setup(s){const V=L(),O=x(),{success:P,showError:A}=E(),{isOnline:K}=function(){const e=a(navigator.onLine),s=a(!1),o=()=>{e.value=!0,s.value&&(s.value=!1)},n=()=>{e.value=!1,s.value=!0};return l(()=>{window.addEventListener("online",o),window.addEventListener("offline",n)}),r(()=>{window.removeEventListener("online",o),window.removeEventListener("offline",n)}),{isOnline:e,wasOffline:s}}(),T=a(),q=o({username:"",password:""}),I={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:(e,a,l)=>{var r;!a||(r=a)&&/^[a-zA-Z0-9_]{3,20}$/.test(r)?l():l(new Error("用户名格式不正确（3-20位字母数字下划线）"))},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:(e,a,l)=>{a&&a.length<6?l(new Error("密码至少需要6个字符")):l()},trigger:"blur"}]},M=n(()=>q.username.trim().length>0&&q.password.trim().length>=6&&K.value);function R(){return e(this,null,function*(){T.value&&(yield T.value.validate(a=>e(this,null,function*(){if(a)try{yield O.login(q.username.trim(),q.password),P("登录成功，正在跳转..."),V.push("/")}catch(e){A(e,"登录失败，请检查用户名和密码")}})))})}return(e,a)=>{const l=p("el-icon"),r=p("el-input"),s=p("el-form-item"),o=p("el-button"),n=p("el-form"),x=p("el-alert"),L=p("el-card");return m(),t("div",z,[i(L,{class:"login-card",shadow:"always"},{header:d(()=>[u("div",j,[i(l,{size:40,color:"#409eff"},{default:d(()=>[i(g(_))]),_:1}),a[2]||(a[2]=u("h1",null,"Token 管理平台",-1)),a[3]||(a[3]=u("p",{class:"subtitle"},"分布式令牌限流管理系统",-1))])]),default:d(()=>[i(n,{ref_key:"formRef",ref:T,model:q,rules:I,"label-position":"top",size:"large",onSubmit:f(R,["prevent"])},{default:d(()=>[i(s,{label:"用户名",prop:"username"},{default:d(()=>[i(r,{modelValue:q.username,"onUpdate:modelValue":a[0]||(a[0]=e=>q.username=e),placeholder:"请输入用户名","prefix-icon":g(w),clearable:"",autofocus:"",onKeyup:v(R,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),i(s,{label:"密码",prop:"password"},{default:d(()=>[i(r,{modelValue:q.password,"onUpdate:modelValue":a[1]||(a[1]=e=>q.password=e),type:"password",placeholder:"请输入密码","prefix-icon":g(h),"show-password":"",clearable:"",onKeyup:v(R,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),i(s,null,{default:d(()=>[i(o,{type:"primary","native-type":"submit",loading:g(O).loginLoading,disabled:!M.value,style:{width:"100%"},size:"large"},{default:d(()=>[b(y(g(O).loginLoading?"登录中...":"登录"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"]),g(K)?c("",!0):(m(),t("div",k,[i(x,{type:"error",closable:!1,"show-icon":""},{default:d(()=>[...a[4]||(a[4]=[b(" 网络连接已断开，请检查网络设置 ",-1)])]),_:1})]))]),_:1}),a[5]||(a[5]=u("div",{class:"login-footer"},[u("p",null,"© 2024 Token Management Platform. All rights reserved.")],-1))])}}}),[["__scopeId","data-v-d6599b18"]]);export{O as default};
